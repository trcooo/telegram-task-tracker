<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B35">
    <title>TaskFlow - LeaderTask Style</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary: #FF6B35;    /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
            --primary-dark: #E55A2B;
            --primary-light: #FF8B5C;
            --secondary: #2D3436;  /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π/—á–µ—Ä–Ω—ã–π */
            --secondary-dark: #1A1E1F;
            --secondary-light: #636E72;
            --accent: #0984E3;     /* –°–∏–Ω–∏–π –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤ */
            --success: #00B894;    /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö */
            --danger: #D63031;     /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –≤–∞–∂–Ω–æ–≥–æ */
            --warning: #FDCB6E;    /* –ñ–µ–ª—Ç—ã–π –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
            --light: #F5F6FA;
            --dark: #2D3436;
            --gray: #B2BEC3;
            --gray-light: #DFE6E9;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--light);
            color: var(--secondary);
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            padding: 24px 20px;
            position: relative;
            overflow: hidden;
        }

        .app-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            border-radius: 0 0 0 100%;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text h1 {
            font-size: 20px;
            font-weight: 800;
            color: white;
            margin-bottom: 2px;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.8;
            color: var(--gray);
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            font-size: 20px;
        }

        .date-display {
            text-align: center;
            margin-top: 10px;
            position: relative;
            z-index: 2;
        }

        .current-date {
            font-size: 14px;
            opacity: 0.9;
            color: var(--gray);
        }

        .current-day {
            font-size: 32px;
            font-weight: 800;
            color: white;
            margin: 5px 0;
        }

        .current-month {
            font-size: 16px;
            opacity: 0.9;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .app-nav {
            display: flex;
            justify-content: space-around;
            padding: 16px 20px;
            background: white;
            border-bottom: 1px solid var(--gray-light);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--secondary-light);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: var(--border-radius);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .app-content {
            padding: 20px;
            min-height: 60vh;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar-container {
            margin-top: 10px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-nav-btn:hover {
            background: var(--gray-light);
        }

        .current-month-year {
            font-size: 18px;
            font-weight: 600;
            color: var(--secondary);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: var(--secondary-light);
            padding: 8px 0;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--gray-light);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .calendar-day.selected {
            background: var(--secondary);
            color: white;
        }

        .calendar-day.has-tasks::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        .calendar-day.other-month {
            color: var(--gray);
        }

        /* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ */
        .add-task-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 2px solid var(--gray-light);
        }

        .form-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-title i {
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--secondary-light);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-control::placeholder {
            color: var(--gray);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .priority-selector {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .priority-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            background: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .priority-btn:hover {
            border-color: var(--primary-light);
        }

        .priority-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 16px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á */
        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--secondary);
        }

        .task-count {
            background: var(--gray-light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: var(--secondary-light);
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--gray-light);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--secondary-light);
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
        }

        .task-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 18px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.3s ease-out;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--success);
        }

        .task-item.overdue {
            border-left-color: var(--danger);
        }

        .task-item.high-priority {
            border-left-color: var(--danger);
        }

        .task-item.medium-priority {
            border-left-color: var(--warning);
        }

        .task-item.low-priority {
            border-left-color: var(--success);
        }

        .task-content {
            display: flex;
            gap: 14px;
        }

        .task-checkbox {
            flex-shrink: 0;
            width: 22px;
            height: 22px;
            border: 2px solid var(--gray);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--secondary-light);
        }

        .task-description {
            font-size: 14px;
            color: var(--secondary-light);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
            color: var(--secondary-light);
        }

        .task-date {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .task-date.overdue {
            color: var(--danger);
            font-weight: 600;
        }

        .task-priority {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-high {
            background: rgba(214, 48, 49, 0.1);
            color: var(--danger);
        }

        .priority-medium {
            background: rgba(253, 203, 110, 0.1);
            color: #E17055;
        }

        .priority-low {
            background: rgba(0, 184, 148, 0.1);
            color: var(--success);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid var(--gray-light);
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-edit {
            background: rgba(255, 107, 53, 0.1);
            color: var(--primary);
        }

        .btn-edit:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .btn-delete {
            background: rgba(214, 48, 49, 0.1);
            color: var(--danger);
        }

        .btn-delete:hover {
            background: rgba(214, 48, 49, 0.2);
        }

        .completed-tasks-section {
            background: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-top: 30px;
            border: 1px solid var(--gray-light);
        }

        .completed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--gray-light);
        }

        .completed-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--secondary-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-completed {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .completed-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .completed-list.collapsed {
            display: none;
        }

        /* –ú–µ–Ω—é */
        .menu-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--secondary-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-light);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s;
            color: var(--secondary);
            text-decoration: none;
        }

        .menu-item:hover {
            background: var(--light);
            transform: translateX(5px);
        }

        .menu-item i {
            width: 24px;
            text-align: center;
            font-size: 18px;
            color: var(--primary);
        }

        .menu-item span {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
        }

        .menu-item .badge {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border-top: 4px solid var(--primary);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--secondary-light);
            font-weight: 500;
        }

        /* –§—É—Ç–µ—Ä */
        .app-footer {
            padding: 20px;
            text-align: center;
            color: var(--secondary-light);
            font-size: 12px;
            border-top: 1px solid var(--gray-light);
            background: white;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .task-item.new {
            animation: pulse 0.5s ease-out;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 500px) {
            .app-container {
                border-radius: 0;
            }

            .app-header {
                padding: 20px 16px;
            }

            .logo-text h1 {
                font-size: 18px;
            }

            .current-day {
                font-size: 28px;
            }

            .app-content {
                padding: 16px;
            }
        }

        /* –°–≤–∏—Ç—á–µ—Ä —Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
        .theme-switcher {
            position: absolute;
            top: 20px;
            right: 70px;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(30deg);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">TF</div>
                    <div class="logo-text">
                        <h1>TaskFlow</h1>
                        <p></p>
                    </div>
                </div>

                <div class="theme-switcher">
                    <button class="theme-btn" id="themeToggle">
                        <i class="bi bi-sun"></i>
                    </button>
                </div>

                <div class="user-avatar" id="userAvatar">
                    <i class="bi bi-person"></i>
                </div>
            </div>

            <div class="date-display">
                <div class="current-date" id="currentDate">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 1 —è–Ω–≤–∞—Ä—è</div>
                <div class="current-day" id="currentDay">1</div>
                <div class="current-month" id="currentMonth">–Ø–Ω–≤–∞—Ä—å 2024</div>
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="app-nav">
            <a href="#" class="nav-item active" data-section="tasks">
                <i class="bi bi-list-task"></i>
                <span>–ó–∞–¥–∞—á–∏</span>
                <span class="nav-badge" id="pendingBadge">0</span>
            </a>
            <a href="#" class="nav-item" data-section="calendar">
                <i class="bi bi-calendar"></i>
                <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
            </a>
            <a href="#" class="nav-item" data-section="add">
                <i class="bi bi-plus-circle"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </a>
            <a href="#" class="nav-item" data-section="menu">
                <i class="bi bi-three-dots"></i>
                <span>–ú–µ–Ω—é</span>
            </a>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="app-content">
            <!-- –°–µ–∫—Ü–∏—è –∑–∞–¥–∞—á -->
            <section id="tasksSection" class="content-section active">
                <div class="tasks-header">
                    <h2 class="section-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
                    <span class="task-count" id="activeCount">0 –∑–∞–¥–∞—á</span>
                </div>

                <div class="tasks-list" id="activeTasksList">
                    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>

                <!-- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
                <div class="completed-tasks-section">
                    <div class="completed-header">
                        <h3 class="completed-title">
                            <i class="bi bi-check2-circle"></i>
                            –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
                        </h3>
                        <button class="toggle-completed" id="toggleCompleted">
                            <span>–°–∫—Ä—ã—Ç—å</span>
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="completed-list" id="completedTasksList">
                        <!-- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
            <section id="calendarSection" class="content-section">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="prevMonth">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <h2 class="current-month-year" id="currentMonthYear">–Ø–Ω–≤–∞—Ä—å 2024</h2>
                    <button class="calendar-nav-btn" id="nextMonth">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>

                <div class="calendar-container">
                    <div class="calendar-weekdays">
                        <div class="weekday">–ü–Ω</div>
                        <div class="weekday">–í—Ç</div>
                        <div class="weekday">–°—Ä</div>
                        <div class="weekday">–ß—Ç</div>
                        <div class="weekday">–ü—Ç</div>
                        <div class="weekday">–°–±</div>
                        <div class="weekday">–í—Å</div>
                    </div>

                    <div class="calendar-days" id="calendarDays">
                        <!-- –î–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tasks-list" id="calendarTasksList" style="margin-top: 30px;">
                    <!-- –ó–∞–¥–∞—á–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
            <section id="addSection" class="content-section">
                <div class="add-task-card">
                    <h3 class="form-title">
                        <i class="bi bi-plus-circle"></i>
                        –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
                    </h3>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                        <input type="text" class="form-control" id="taskTitle" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea class="form-control" id="taskDescription" rows="3" placeholder="–î–æ–±–∞–≤—å—Ç–µ –¥–µ—Ç–∞–ª–∏..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–î–∞—Ç–∞</label>
                            <input type="date" class="form-control" id="taskDate">
                        </div>

                        <div class="form-group">
                            <label class="form-label">–í—Ä–µ–º—è</label>
                            <input type="time" class="form-control" id="taskTime">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                        <div class="priority-selector">
                            <button class="priority-btn" data-priority="high">–í—ã—Å–æ–∫–∏–π</button>
                            <button class="priority-btn active" data-priority="medium">–°—Ä–µ–¥–Ω–∏–π</button>
                            <button class="priority-btn" data-priority="low">–ù–∏–∑–∫–∏–π</button>
                        </div>
                    </div>

                    <button class="btn-primary" id="addTaskBtn">
                        <i class="bi bi-plus-lg"></i>
                        –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                    </button>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –º–µ–Ω—é -->
            <section id="menuSection" class="content-section">
                <div class="menu-container">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalTasksStat">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="completedTasksStat">0</div>
                            <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pendingTasksStat">0</div>
                            <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="overdueTasksStat">0</div>
                            <div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                        </div>
                    </div>

                    <div class="menu-section">
                        <h4 class="menu-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
                        <a href="#" class="menu-item">
                            <i class="bi bi-bell"></i>
                            <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                            <span class="badge">–í–∫–ª</span>
                        </a>
                        <a href="#" class="menu-item">
                            <i class="bi bi-palette"></i>
                            <span>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</span>
                        </a>
                        <a href="#" class="menu-item">
                            <i class="bi bi-translate"></i>
                            <span>–Ø–∑—ã–∫</span>
                            <span class="badge">RU</span>
                        </a>
                    </div>

                    <div class="menu-section">
                        <h4 class="menu-title">–î–µ–π—Å—Ç–≤–∏—è</h4>
                        <a href="#" class="menu-item" id="exportTasks">
                            <i class="bi bi-download"></i>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á</span>
                        </a>
                        <a href="#" class="menu-item" id="clearCompleted">
                            <i class="bi bi-trash"></i>
                            <span>–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</span>
                        </a>
                        <a href="#" class="menu-item" id="syncTasks">
                            <i class="bi bi-arrow-repeat"></i>
                            <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
                        </a>
                    </div>
                </div>
            </section>
        </main>

        <!-- –§—É—Ç–µ—Ä -->
        <footer class="app-footer">
            <p>TaskFlow ¬© 2024 ‚Ä¢ –°—Ç–∏–ª—å LeaderTask</p>
            <p>–í—Å–µ –∑–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        </footer>
    </div>

    <!-- Flatpickr –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
/**
 * TaskFlow patched JS:
 * - Telegram viewport fix (borders not jumping)
 * - Server sync via /api (for reminders + persistence)
 * - Fix update bug (no duplicates after edit)
 * - Overdue highlight kept
 */
(function () {
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  const API = window.location.origin;

  function applyTelegramViewportFix() {
    const setVh = () => {
      const h = tg?.viewportHeight ? tg.viewportHeight : window.innerHeight;
      document.documentElement.style.setProperty('--tg-vh', `${h}px`);
    };
    setVh();
    tg?.onEvent?.('viewportChanged', setVh);
    window.addEventListener('resize', setVh);
  }

  // --- basic notify (uses existing #notification) ---
  function showNotification(message, type = 'info') {
    const el = document.getElementById('notification');
    if (!el) return alert(message);
    el.textContent = message;
    el.className = `notification ${type} show`;
    setTimeout(() => el.classList.remove('show'), 2200);
  }

  function isoFromInputs(dateStr, timeStr) {
    if (!dateStr) return null;
    let dt;
    if (timeStr) dt = new Date(`${dateStr}T${timeStr}`);
    else {
      dt = new Date(dateStr);
      dt.setHours(23, 59, 0, 0);
    }
    return dt.toISOString();
  }

  // --- state ---
  let userId = 1;
  let tasks = [];
  let selectedPriority = 'medium';
  let editingTaskId = null;

  // --- telegram init ---
  function initTelegram() {
    applyTelegramViewportFix();

    if (tg) {
      tg.expand();
      const user = tg.initDataUnsafe?.user;
      if (user?.id) userId = user.id;

      // optional: replace slogan with greeting if element exists
      const p = document.querySelector('.logo-text p');
      if (p) {
        const hour = new Date().getHours();
        let g = '–ü—Ä–∏–≤–µ—Ç';
        if (hour >= 5 && hour < 12) g = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
        else if (hour >= 12 && hour < 18) g = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
        else if (hour >= 18 && hour < 23) g = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
        p.textContent = `${g}, ${user?.first_name || '–¥—Ä—É–≥'}!`;
      }
    }
  }

  // --- API helpers ---
  async function apiGetTasks() {
    const r = await fetch(`${API}/api/tasks/${userId}`);
    if (!r.ok) throw new Error('get tasks failed');
    return await r.json();
  }
  async function apiCreateTask(payload) {
    const r = await fetch(`${API}/api/tasks`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if (!r.ok) throw new Error('create failed');
    return await r.json();
  }
  async function apiUpdateTask(id, payload) {
    const r = await fetch(`${API}/api/tasks/${id}`, {
      method: 'PUT',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if (!r.ok) throw new Error('update failed');
    return await r.json();
  }
  async function apiDeleteTask(id) {
    const r = await fetch(`${API}/api/tasks/${id}`, {method:'DELETE'});
    if (!r.ok) throw new Error('delete failed');
    return await r.json();
  }
  async function apiToggle(id, done) {
    const ep = done ? 'done' : 'undone';
    const r = await fetch(`${API}/api/tasks/${id}/${ep}`, {method:'POST'});
    if (!r.ok) throw new Error('toggle failed');
    return await r.json();
  }

  // --- rendering ---
  function isOverdue(task) {
    if (task.completed || !task.due_at) return false;
    return new Date(task.due_at) < new Date();
  }

  function formatDue(task) {
    if (!task.due_at) return '–ë–µ–∑ —Å—Ä–æ–∫–∞';
    const d = new Date(task.due_at);
    const date = d.toLocaleDateString('ru-RU', { day:'2-digit', month:'2-digit', year:'numeric' });
    const time = d.toLocaleTimeString('ru-RU', { hour:'2-digit', minute:'2-digit' });
    return `${date} ${time}`;
  }

  function render() {
    const activeList = document.getElementById('activeTasksList');
    const completedList = document.getElementById('completedTasksList');
    if (!activeList || !completedList) return;

    const active = tasks.filter(t => !t.completed);
    const done = tasks.filter(t => t.completed);

    activeList.innerHTML = '';
    completedList.innerHTML = '';

    active.forEach(t => activeList.appendChild(taskEl(t)));
    done.forEach(t => completedList.appendChild(taskEl(t)));

    const stats = document.getElementById('tasksCount') || document.getElementById('statsPill');
    if (stats) stats.textContent = `${active.length}`;
  }

  function taskEl(task) {
    const el = document.createElement('div');
    el.className = 'task-item';
    if (task.completed) el.classList.add('completed');
    if (isOverdue(task)) el.classList.add('overdue');

    el.innerHTML = `
      <div class="task-header">
        <div class="task-title">${escapeHtml(task.title)}</div>
        <div class="task-actions">
          <button class="btn-edit">‚úèÔ∏è</button>
          <button class="btn-del">üóëÔ∏è</button>
        </div>
      </div>
      ${task.description ? `<div class="task-desc">${escapeHtml(task.description)}</div>` : ''}
      <div class="task-footer">
        <span class="task-date ${isOverdue(task) ? 'overdue' : ''}">${formatDue(task)}</span>
        <span class="task-priority">${task.priority || 'medium'}</span>
        <label class="task-check">
          <input type="checkbox" ${task.completed ? 'checked' : ''} />
          <span>–ì–æ—Ç–æ–≤–æ</span>
        </label>
      </div>
    `;

    el.querySelector('input[type="checkbox"]').addEventListener('change', async (e) => {
      await apiToggle(task.id, e.target.checked);
      await refresh();
    });

    el.querySelector('.btn-del').addEventListener('click', async () => {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;
      await apiDeleteTask(task.id);
      await refresh();
      showNotification('–£–¥–∞–ª–µ–Ω–æ', 'info');
    });

    el.querySelector('.btn-edit').addEventListener('click', () => {
      startEdit(task);
    });

    return el;
  }

  function escapeHtml(str) {
    return (str || '').replace(/[&<>"']/g, (m) => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
    }[m]));
  }

  // --- form ---
  function bindPriorityButtons() {
    const buttons = document.querySelectorAll('.priority-btn');
    if (!buttons.length) return;
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedPriority = btn.dataset.priority || 'medium';
      });
    });
  }

  function resetForm() {
    document.getElementById('taskTitle').value = '';
    document.getElementById('taskDescription').value = '';
    document.getElementById('taskDate').value = '';
    document.getElementById('taskTime').value = '';
    editingTaskId = null;

    selectedPriority = 'medium';
    const buttons = document.querySelectorAll('.priority-btn');
    buttons.forEach(b => b.classList.toggle('active', (b.dataset.priority||'') === 'medium'));

    const btn = document.getElementById('addTaskBtn');
    if (btn) btn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É';
  }

  async function addOrSave() {
    const title = document.getElementById('taskTitle').value.trim();
    const description = document.getElementById('taskDescription').value.trim();
    const date = document.getElementById('taskDate').value;
    const time = document.getElementById('taskTime').value;

    if (!title) {
      showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', 'warning');
      return;
    }

    const due_at = isoFromInputs(date, time);

    if (!editingTaskId) {
      await apiCreateTask({
        user_id: userId,
        title,
        description,
        priority: selectedPriority,
        due_at
      });
      showNotification('–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
    } else {
      await apiUpdateTask(editingTaskId, {
        title,
        description,
        priority: selectedPriority,
        due_at
      });
      showNotification('–ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
    }

    resetForm();
    await refresh();
  }

  function startEdit(task) {
    editingTaskId = task.id;
    document.getElementById('taskTitle').value = task.title || '';
    document.getElementById('taskDescription').value = task.description || '';

    if (task.due_at) {
      const d = new Date(task.due_at);
      document.getElementById('taskDate').value = d.toISOString().slice(0,10);
      document.getElementById('taskTime').value = d.toTimeString().slice(0,5);
    } else {
      document.getElementById('taskDate').value = '';
      document.getElementById('taskTime').value = '';
    }

    selectedPriority = task.priority || 'medium';
    const buttons = document.querySelectorAll('.priority-btn');
    buttons.forEach(b => b.classList.toggle('active', (b.dataset.priority||'') === selectedPriority));

    const btn = document.getElementById('addTaskBtn');
    if (btn) btn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';

    window.scrollTo({top:0, behavior:'smooth'});
  }

  async function refresh() {
    try {
      tasks = await apiGetTasks();
      localStorage.setItem('tasks_cache', JSON.stringify(tasks));
    } catch (e) {
      const cached = localStorage.getItem('tasks_cache');
      tasks = cached ? JSON.parse(cached) : [];
      showNotification('–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º, –ø–æ–∫–∞–∑–∞–Ω –∫—ç—à', 'warning');
    }
    render();
  }

  document.addEventListener('DOMContentLoaded', async () => {
    initTelegram();
    bindPriorityButtons();

    const btn = document.getElementById('addTaskBtn');
    if (btn) btn.addEventListener('click', addOrSave);

    await refresh();
  });

})();
</script>
</body>
</html>